<template>
  <div id="app">
    <button @click="save">save</button>
    <button @click="load">load</button>
    <SettingsScreen v-if="showSettings" @close-settings="closeSettings"/>
    <MoneyLeftModal v-else-if="showModal"/>
    <div v-else>
      <StatusSection @open-settings="openSettings"/>
      <CanSpendToday/>
      <SpendingInput/>
      <RevertButton :hasHistory="hasHistory"/>
      <Numpad/>
    </div>

  </div>
</template>

<script>
import { mapState } from 'vuex';
import StatusSection from './components/StatusSection.vue';
import CanSpendToday from './components/CanSpendToday.vue';
import SpendingInput from './components/SpendingInput.vue';
import SettingsScreen from './components/SettingsScreen.vue';
import MoneyLeftModal from './components/MoneyLeftModal.vue';
import RevertButton from './components/RevertButton.vue';
import Numpad from './components/Numpad.vue';

export default {
  name: 'App',
  data() {
    return {
      showSettings: false,
    };
  },
  components: {
    StatusSection,
    CanSpendToday,
    SpendingInput,
    SettingsScreen,
    MoneyLeftModal,
    RevertButton,
    Numpad,
  },
  methods: {
    openSettings() {
      this.showSettings = true;
    },
    closeSettings() {
      this.showSettings = false;
    },
    save() {
      localStorage.setItem('state', JSON.stringify(this.$store.state));
    },
    load() {
      const loadedState = localStorage.getItem('state');
      if (loadedState) {
        const parsedState = JSON.parse(loadedState);
        this.$store.replaceState(parsedState);
      }
    },
  },
  computed: {
    ...mapState({ history: 'beforeLastSpending', showModal: 'showModal' }),
    hasHistory() {
      return !!this.history;
    },
  },
  mounted() {
    this.$store.dispatch('INITIALISE');
  },
};
</script>

<style>

</style>
